<!DOCTYPE html>
<html  >
{% include 'header.html' %}

</br>
</br>
</br>
</br>
</br>
<center>
<div id='loginform' class='item-title mbr-fonts-style display-7 align-items-center'>
<h1><strong>Log in</strong></h1>
</br>
</br>
Please use the form below to log into your account.
</br>
</br>
</br>
<center>

<label for="email" class="col-sm-2 col-form-label"><strong>Email address</strong></label>
<div class="col-sm-3">
	<input type="email" class="form-control" id="email">
</div>
</br> 
<label for="password" class="col-sm-2 col-form-label"><strong>Password</strong></label>
<div class="col-sm-3">
  <input type="password" class="form-control" id="password">
</div>

</center>
</br>
</br>
<button type=submit class="btn btn-primary display-4" id="toggle" onclick="loginUser()"><strong>Log in</strong></button>
</br>
</br>
Forgot password? <a href='{{request.session.get("base_url")}}/reset'>reset it here.</a>
</br>
</br>
</div>
</center>
</br>
</br>
</br>
</br>
</br>
</br>
</br>
<div class='locationsection' style="display: None">
  <label for="city" class="col-sm-2 col-form-label mbr-section-subtitle display-5">City</label>
  <div class="col-sm-3">
      <input class="form-control" id="city">
  </div>
  </br>
  <label for="state" class="col-sm-2 col-form-label mbr-section-subtitle display-5">State</label>
  <div class="col-sm-3">
      <input class="form-control" id="state">
  </div>
  </br>
  <label for="country" class="col-sm-2 col-form-label mbr-section-subtitle display-5">Country</label>
  <div class="col-sm-3">
      <input class="form-control" id="country">
  </div>
  </br>
  <label for="ip" class="col-sm-2 col-form-label mbr-section-subtitle display-5">IP</label>
  <div class="col-sm-3">
      <input class="form-control" id="ip">
  </div>
  </br>
  <label for="timezone" class="col-sm-2 col-form-label mbr-section-subtitle display-5">Timezone</label>
  <div class="col-sm-3">
      <input class="form-control" id="timezone">
  </div>
</div>

<script>
output=jQuery.get("http://ipinfo.io", function(response) {
    document.getElementById("city").value = response.city
    document.getElementById("state").value = response.region
    document.getElementById("country").value = response.country
    document.getElementById("ip").value = response.ip
    document.getElementById("timezone").value = response.timezone
}, "jsonp");

// login function
function loginUser() {

  email=document.getElementById('email').value
  password=document.getElementById('password').value

  let data = {"email": email,
              "password": password,
              "city": document.getElementById("city").value,
              "state": document.getElementById("state").value,
              "country": document.getElementById("country").value,
              "ip_address": document.getElementById("ip").value,
              "time_zone": document.getElementById("timezone").value};

  fetch("/api/user/login", {
    method: "POST",
    headers: {'Content-Type': 'application/json'}, 
    body: JSON.stringify(data)})
  .then((response) => response.json())
  .then((data) => window.location.replace('/create_session?token_id='+data.login_token+'&email='+email))
};

// redirect to home page
</script>

</html>